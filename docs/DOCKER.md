# Docker Guide

This guide provides instructions for running the Solana Dex (BMV) bot using Docker.

## Prerequisites

- [Docker](https://docs.docker.com/get-docker/)
- [Docker Compose](https://docs.docker.com/compose/install/)

## Quick Start

1. **Prepare Environment**:

   ```powershell
   copy .env.example .env
   ```

   Edit `.env` and provide your Solana RPC URLs and keypair paths.

2. **Build and Start**:

   ```powershell
   docker-compose up -d --build
   ```

3. **Check Status**:

   ```powershell
   docker-compose ps
   docker-compose logs -f
   ```

## Configuration in Docker

By default, the `docker-compose.yml` maps:

- `./data` -> `/app/data` (for SQLite database persistence)

**Recommendation**: Use environment variables (`WALLET_KEYPAIRS`) for secrets rather than mounting volumes for sensitive key files where possible.

The `docker-compose.yml` includes a full observability stack. For security, **ports are bound to 127.0.0.1 by default**. Use an SSH tunnel to access these from a remote machine.

- **Bot Metrics**: Exposed at `http://localhost:9000`.
- **Prometheus**: Scrapes bot metrics and stores them. Accessible at `http://localhost:9090`.
- **Grafana**: Visualizes metrics via dashboards. Accessible at `http://localhost:3000`.
  - **Credentials**: `admin` / `admin` (Change this in `docker-compose.yml` via `GRAFANA_PASSWORD`).
  - **Data Source**: Pre-configured to point to Prometheus.

To import the health dashboard:
1. Go to Grafana -> Dashboards -> Import.
2. Upload `docs/grafana_health_dashboard.json`.

### Commands

To run the bot with custom arguments:

```powershell
docker run --env-file .env solana-dex-bmv /app/solana-dex-bmv --config /app/config.yaml
```

### Security

- **Non-Root User**: The bot runs as `botuser` in the container.
- **Write Permissions**: Ensure the host `./data` directory is writable by UID 1000 (standard for `botuser`).
- **Network**: All internal services communicate over a private Docker network (`bot-network`).
- **Secret Masking**: All logs generated by the container automatically have sensitive keys masked.

### Troubleshooting
