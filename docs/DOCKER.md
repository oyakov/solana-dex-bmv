# Docker Guide

This guide provides instructions for running the Solana Dex (BMV) bot using Docker.

## Prerequisites

- [Docker](https://docs.docker.com/get-docker/)
- [Docker Compose](https://docs.docker.com/compose/install/)

## Quick Start

1. **Prepare Environment**:

   ```powershell
   copy .env.example .env
   ```

   Edit `.env` and provide your Solana RPC URLs and keypair paths.

2. **Build and Start (Dev/Default)**:

   By default, the stack is optimized for low RAM/CPU and runs without monitoring tools.

   ```powershell
   docker-compose up -d --build
   ```

3. **Start with Production Profile (Monitoring Enabled)**:

   To enable Prometheus and keep the stack running for production:

   ```powershell
   docker-compose --profile prod up -d
   ```

4. **Check Status**:

   ```powershell
   docker-compose ps
   docker-compose logs -f
   ```

## Configuration & Optimization

The `docker-compose.yml` has been optimized for performance and resource utilization:

- **Postgres**: Optimized for low RAM (128MB shared buffers).
- **Resource Limits**: 
  - Bot: Max 512MB RAM, 1.0 CPU.
  - Dashboard: Max 512MB RAM, 0.5 CPU.
  - Postgres: Max 256MB RAM, 0.5 CPU.
- **Prometheus**: Included in the `prod` profile only.
- **Grafana**: Removed from the local stack to save resources.

By default, the `docker-compose.yml` maps:

- `./data` -> `/app/data` (for SQLite database persistence)

**Recommendation**: Use environment variables (`WALLET_KEYPAIRS`) for secrets rather than mounting volumes for sensitive key files where possible.

### Monitoring

- **Bot Metrics**: Exposed at `http://localhost:9000`.
- **Prometheus**: Scrapes bot metrics. Accessible at `http://localhost:9090` (Prod profile only).

### Commands

To run the bot with custom arguments:

```powershell
docker run --env-file .env solana-dex-bmv /app/solana-dex-bmv --config /app/config.yaml
```

### Security

- **Non-Root User**: The bot runs as `botuser` in the container.
- **Write Permissions**: Ensure the host `./data` directory is writable by UID 1000 (standard for `botuser`).
- **Network**: All internal services communicate over a private Docker network (`bot-network`).
- **Secret Masking**: All logs generated by the container automatically have sensitive keys masked.

### Troubleshooting
