# DEX Trading Bot — Требования

## 1. Общее описание

Цель проекта — разработка автоматизированного торгового бота для децентрализованных бирж (DEX) в сети Solana.
Бот ориентирован на **долгосрочную инвестиционную стабилизацию цены**, а не на краткосрочную спекуляцию.

Бот работает через API **Raydium** и **Jupiter** как пользовательские торговые интерфейсы, при этом использует **OpenBook (ранее Serum)** как базовую инфраструктуру книги ордеров для лимитных заявок.

Основные цели бота:

- Удержание цены токена в заданном восходящем ценовом канале через механизм **Pivot Point (VWAP)**
- Стратегическое накопление токенов
- Получение прибыли за счёт спекулянтов
- Реинвестирование прибыли в усиление ценового канала
- Формирование доверия и стабильности для долгосрочных холдеров (инвесторов)

---

## 2. Поддерживаемая инфраструктура

### 2.1 Блокчейн

- Solana

### 2.2 DEX и ликвидность

- Raydium AMM V4 (Standard AMM)
- Jupiter (для маршрутизации и свапов)
- OpenBook (для доступа к книге лимитных ордеров)
- Интеграция с **DEXScreener** и **RugCheck** для мониторинга и верификации

### 2.3 Доступ к стакану ордеров

- Полный доступ к книге ордеров OpenBook
- Возможность выставлять **лимитные ордера** (не только рыночные свапы)
- Интеграция через:
  - OpenBook API
  - Dexlab
  - Raydium Pro / Advanced View
- **Market ID (OpenBook):** `B9coHrCxYv7xmPfSU7Z5VfugDqdTdZqZTpBGBdazq8AC`

---

## 3. Информация о токене и пуле

- **Mint-адрес токена (CA):**
  `8VMi93EEqSGCHGjRGNhEFBkGoNZTQxUFfFYWDEX2e5Uf`

- **Торговая пара:**
  Пользовательский токен (BMV) / SOL

- **Фиатный ориентир:**
  USD или EUR (через кросс-курс SOL → Fiat)

- **Тип пула ликвидности:**
  Raydium AMM V4 (Standard AMM)

- **Рыночные и лимитные ордера:**
  Поддерживаются через интеграцию с OpenBook Market

- **Jito Bundles:**
  Используются для бандлинга транзакций, приоритетного исполнения и защиты от MEV-ботов. Тип чаевых (Jito Tip): `0.005 SOL`.

---

## 4. Управление кошельками

### 4.1 Архитектура с несколькими кошельками

- Бот подключается к **нескольким кошелькам** (минимум 3 основных роли)
- Сделки выполняются в **псевдослучайной, чередующейся последовательности**
- Цели:
  - Снижение обнаруживаемости другими ботами
  - Отсутствие явных ончейн-паттернов
  - Защита от MEV и sniper-ботов

### 4.2 Балансы кошельков

Бот постоянно отслеживает:

- Баланс токена
- Баланс SOL
- Баланс USDC (на кошельке #3 для Фиатного демпфера)
- Фиатный эквивалент

---

## 5. Торговая стратегия: Pivot Point & Grid

### 5.1 Контроль через Pivot Point (VWAP)

- Вместо простого канала используется динамический **Pivot Point**, рассчитываемый как VWAP (Volume Weighted Average Price) за период (например, 365 дней).
- **Linear Fade-in:** В начале работы бота цена SOL/USD и Pivot Point плавно адаптируются к реальной рыночной цене токена BMV/USD.

### 5.2 Сеточные лимитные ордера (32 ордера)

- Бот строит сетку из **32 лимитных ордеров** (16 на покупку, 16 на продажу).
- **BUY-зона (Support):** 16 ордеров. Ширина настраивается (`BUY_CHANNEL_WIDTH_%`, по умолчанию 15%). Основная задача — удержание "бетонного пола" цены. Объем регулируется параметром `TARGET_CONTROL_%`.
- **SELL-зона (Growth):** 16 ордеров. Ширина настраивается (`SELL_CHANNEL_WIDTH_%`, по умолчанию 30%). Ордера на продажу выставляются разреженно для стимулирования роста.

### 5.3 Event-driven исполнение

- Ордера переставляются при значительном изменении цены или по истечении времени (например, 1 час).

---

## 6. Фиатный демпфер (Fiat Manager)

Параллельный процесс для защиты цены относительно USD:

1. **Дивиденды (Dividend):** Когда цена в SELL-зоне, часть прибыли (до `MAX_FIAT_ALLOCATION_%`) конвертируется в USDC на кошелек #3 через Jupiter.
2. **Инъекция (Injection):** Если SOL падает к USD, бот пересчитывает BUY-сетку выше (в SOL), чтобы цена BMV/USD не падала ниже `MIN_FIAT_GROWTH_%`.
3. **Авто-инъекция:** Если баланс SOL падает ниже `MIN_SOL_RESERVE_%`, бот автоматически покупает SOL за USDC с кошелька #3.

---

## 7. Технические операции и оптимизация

### 7.1 Rent Recovery (Возврат аренды)

- Периодически (раз в `RENT_RECOVERY_TIME`) бот выполняет очистку:
  - `Settle Funds` (вывод средств из OpenBook)
  - `Close Empty Accounts` (закрытие пустых аккаунтов для возврата 0.023 SOL за каждый).

### 7.2 Jito Integration

- Все транзакции по перестановке сетки и рыночные сделки ("шум") отправляются через Jito Bundles для защиты от "сэндвич-атак".

---

## 8. Настройки (Config)

| Параметр | Описание | Значение по умолчанию |
| :--- | :--- | :--- |
| `HISTORY_WINDOW_DAYS` | Окно для расчета VWAP | 365 дней |
| `BUY_CHANNEL_WIDTH_%` | Ширина BUY-сетки от Pivot | 15.0% |
| `SELL_CHANNEL_WIDTH_%` | Ширина SELL-сетки от Pivot | 30.0% |
| `ORDERS_PER_SIDE` | Кол-во ордеров на сторону | 16 |
| `TARGET_CONTROL_%` | Целевой объем контроля эмиссии | 51.0% |
| `MIN_FIAT_GROWTH_%` | Мин. рост цены в USD | 15.0% |
| `MAX_FIAT_ALLOCATION_%` | Макс. доля прибыли в фиат | 30.0% |
| `MIN_SOL_RESERVE_%` | Резерв SOL для работы | 70.0% |
| `JITO_TIP_AMOUNT` | Чаевые Jito | 0.005 SOL |
| `RENT_RECOVERY_TIME` | Период очистки аккаунтов | 1 час |

## 9. Ожидаемый результат

Бот, который:

- Удерживает цену BMV в контролируемом восходящем тренде относительно USD.
- Эффективно использует USDC для стабилизации при просадках SOL.
- Минимизирует издержки на аренду аккаунтов и защищен от MEV.
- Создает видимость органической активности через "шумовые" транзакции.
