--------------------------------------------------------------------------------
# Техническая спецификация: BMV Eco System Market Making Bot

## 1. Общая информация и Идентификаторы
**Проект:** BMV Eco System (BMV ES) [1]
**Цель:** Долгосрочная алгоритмическая стабилизация цены, удержание восходящего тренда, защита ликвидности и накопление капитала для реинвестирования [2], [3].

### Критические идентификаторы (IDs)
*   **Token Mint Address (CA):** `8VMi93EEqSGCHGjRGNhEFBkGoNZTQxUFfFYWDEX2e5Uf` [4], [5]
*   **OpenBook Market ID:** `B9coHrCxYv7xmPfSU7Z5VfugDqdTdZqZTpBGBdazq8AC` [6], [7]
*   **Торговая пара:** BMV / SOL (с кросс-курсом к USD/EUR) [8], [9]
*   **Инфраструктура:** Server (Hetzner) [10], [11]

---

## 2. Архитектура системы

### 2.1 Стек протоколов
Бот использует гибридную модель взаимодействия с DEX [12]:
1.  **OpenBook (Ядро):** Используется для размещения **лимитных ордеров** (Maker strategy). Обеспечивает "стены" покупки и продажи. Является единственным способом видеть реальную глубину рынка (Order Book) [4], [6].
2.  **Raydium AMM V4:** Основной пул ликвидности. Бот мониторит состояние пула через API Raydium Pro View [13].
3.  **Jupiter:** Агрегатор для исполнения срочных **рыночных ордеров** (Taker strategy) в случаях, когда необходима быстрая коррекция цены или ребалансировка [14].
4.  **Jito Bundles:** Транспортный слой. Все транзакции (особенно создание и отмена ордеров) отправляются через Jito Block Engine для защиты от MEV (фронтраннинга) и гарантии приоритетного исполнения [15], [14].

### 2.2 Мульти-кошелечная структура
Для обхода технических ограничений и защиты от детекта используется пул из $N$ кошельков [16], [17]:
*   **Преодоление лимита:** OpenBook разрешает максимум **32 ордера** на один аккаунт. Бот суммирует лимиты кошельков ($N \times 32$) для создания плотной сетки [17].
*   **Stealth Mode:** Действия выполняются в псевдослучайной последовательности между кошельками, чтобы скрыть паттерны работы единого крупного игрока [18].

---

## 3. Математическая модель и Логика торгов

### 3.1 Расчет Pivot Point (Точка отсчета)
Центр торгового канала рассчитывается динамически по формуле VWAP с учетом расходов [19], [20]:

$$
Pivot = \frac{\sum (Price \cdot Volume) + \text{Расходы}}{\sum Volume - \text{Комиссии}}
$$

*   **Расходы:** Включают создание Market ID (0.4 SOL), Rent (~0.023 SOL/acc), Jito tips [20].
*   **Гармоничная история:** На старте используется история SOL/USD. Постепенно через коэффициент "Linear Fade-in" происходит замещение данными реальных торгов BMV/SOL [21], [20].

### 3.2 Геометрия канала (Сетка)
Бот строит асимметричный восходящий канал вокруг Pivot Point [22], [23]:
*   **BUY-зона (Нижняя):** Ширина **15%**. 16 ордеров на кошелек.
*   **SELL-зона (Верхняя):** Ширина **30%**. 16 ордеров на кошелек.
*   **Распределение объема:** Экспоненциальное. Объем ордеров растет от центра к краям (мелкие ордера в центре, крупные "стены" на границах) [24].
*   **Шаг:** Равномерный по цене [23].

### 3.3 Цикл пересчета
При исполнении любого ордера (Fill) запускается процедура [25], [7]:
1.  Cancel All (на затронутом кошельке).
2.  **Settle Funds:** Возврат SOL/Token из контракта OpenBook на кошелек (критически важно для OpenBook).
3.  Пересчет Pivot Point.
4.  Place New Orders (выставление новой сетки).

---

## 4. Защитные механизмы и Стратегия

### 4.1 Фиатный пол (Fiat Floor)
Защита от падения курса SOL. Бот удерживает цену токена не ниже **+15%** к стартовой цене в USD/EUR. Если SOL падает, сетка покупок (в SOL) автоматически поднимается вверх [26], [10].

### 4.2 Контроль эмиссии (Target Control PCT)
Алгоритм "51%". Бот мониторит объем токенов на сторонних кошельках. Если доля рынка уходит к спекулянтам, бот агрессивно наращивает Buy-стенки, выкупая эмиссию обратно для сохранения контроля над проектом [26], [7].

### 4.3 Реинвестирование (Growth Model)
Прибыль не выводится. Доход от "бритья" спекулянтов направляется на увеличение размера ордеров в сетке, делая канал более устойчивым к волатильности [27], [28].

### 4.4 Anti-Sniper Launch
На старте бот выставляет плотную сетку лимитных ордеров, чтобы предотвратить мгновенное вымывание ликвидности снайпер-ботами и обеспечить плавный органичный рост [29], [30].

---

## 5. План реализации

Разработка разделена на фазы (общий срок 30-40 дней) [31]:

| Фаза | Название | Ключевые задачи |
| :--- | :--- | :--- |
| **0** | **Подготовка** | Валидация Market ID, доступ к RPC, выбор стека (Python/Rust) [32]. |
| **1** | **Инфраструктура** | Подключение Wallet Manager, Jito, OpenBook API, потоки цен [33]. |
| **2** | **MVP Логики** | Реализация формулы VWAP, Grid Builder (32 ордера), базовый канал [34]. |
| **3** | **Анти-детект** | Ротация кошельков, рандомизация задержек, обфускация транзакций [18]. |
| **4** | **Реинвестирование** | Трекинг PnL, логика увеличения объемов ордеров от прибыли [35]. |
| **5** | **Безопасность** | Risk Manager, Kill Switch, Fiat Floor, защита от рассинхрона [36]. |
| **6** | **Наблюдаемость** | Логирование, CLI Дашборд, метрики [31]. |

---

## 6. Конфигурация (Config.py)
Параметры, подлежащие настройке [37]:
*   `GRID_BUY_WIDTH`: 0.15 (15%)
*   `GRID_SELL_WIDTH`: 0.30 (30%)
*   `ORDERS_PER_SIDE`: 16 (Limit per wallet / 2)
*   `HISTORY_FADE_IN_DAYS`: Настраиваемый период перехода истории.
*   `FIAT_FLOOR_PERCENT`: 1.15 (+15%)
*   `CONTROL_TARGET_PCT`: 0.51 (51%)